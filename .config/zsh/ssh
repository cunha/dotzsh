function zsh-start-ssh-agent {
	echo "starting new ssh-agent" ;
	ssh-agent | sed 's/^echo/#echo/' > $ZSH_SSH_AGENT_ENV ;
	chmod 600 $ZSH_SSH_AGENT_ENV ;
	. $ZSH_SSH_AGENT_ENV > /dev/null ;
}

function zsh-ssh-agent {
	if [[ -n $SSH_AUTH_SOCK ]] ; then
		;
	elif [[ -f $ZSH_SSH_AGENT_ENV ]] ; then
		. $ZSH_SSH_AGENT_ENV > /dev/null
		ps $SSH_AGENT_PID | grep ssh-agent > /dev/null \
				|| zsh-start-ssh-agent
	else
		if [[ ! -o interactive ]] ; then zsh-start-ssh-agent ; fi ;
	fi
	if [[ -o interactive ]] ; then
		echo "bound to SSH agent on socket $SSH_AUTH_SOCK; keys:"
		ssh-add -l
	fi
}

export ZSH_SSH_AGENT_ENV="$HOME/.ssh/ssh-agent-$(hostname)" ;
zsh-ssh-agent ;

